<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Workout Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- iOS "app-like" behavior -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="Workout Coach" />

  <style>
    :root {
      --bg: #020617;
      --bg-card: #020617;
      --accent: #22c55e;
      --accent-soft: #4ade80;
      --accent-muted: #111827;
      --text: #e5e7eb;
      --text-subtle: #9ca3af;
      --danger: #ef4444;
      --border-soft: #1f2937;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      margin: 0;
      padding: 0;
      background: #020617;
      color: var(--text);
    }

    .app {
      max-width: 520px;
      margin: 0 auto;
      padding: 18px;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .card {
      width: 100%;
      background: #020617;
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.6);
      border: 1px solid #111827;
    }

    h1 {
      font-size: 1.6rem;
      margin: 0 0 4px;
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-subtle);
      margin-bottom: 12px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
    }

    .tab-btn {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-subtle);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
    }

    .tab-btn.active {
      background: var(--accent-soft);
      color: #022c22;
      border-color: transparent;
    }

    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    h2 {
      font-size: 1.2rem;
      margin: 6px 0 10px;
      color: #c4b5fd;
    }

    h3 {
      font-size: 1rem;
      margin: 16px 0 6px;
      color: #bfdbfe;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 10px 0;
    }

    li.exercise-row {
      padding: 9px 11px;
      border-radius: 12px;
      background: #020617;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 7px;
      font-size: 0.95rem;
      border: 1px solid var(--border-soft);
      gap: 10px;
    }

    .exercise-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .exercise-name {
      font-size: 0.97rem;
    }

    .badge {
      font-size: 0.8rem;
      opacity: 0.9;
      color: var(--text-subtle);
    }

    /* Buttons */
    button.primary {
      width: 100%;
      margin-top: 12px;
      padding: 11px;
      border-radius: 999px;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      background: var(--accent);
      color: #022c22;
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    button.primary.done {
      background: #111827;
      color: var(--text);
    }

    button.primary:active {
      transform: scale(0.97);
      box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    }

    button.secondary {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
      background: var(--accent-muted);
      color: var(--text);
    }

    button.small {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-subtle);
      font-size: 0.8rem;
      cursor: pointer;
    }

    .info-btn {
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--accent-soft);
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .small-text {
      font-size: 0.82rem;
      color: var(--text-subtle);
      margin-top: 8px;
    }

    .streak {
      margin-top: 8px;
      font-size: 0.9rem;
    }

    .streak-strong {
      color: var(--accent-soft);
      font-weight: 600;
    }

    /* Inline rows */
    .row-inline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    .inline-select {
      width: auto;
      min-width: 110px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text);
      font-size: 0.82rem;
    }

    /* History rows */
    .status-row {
      padding: 7px 10px;
      background: #020617;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 5px;
      border: 1px solid var(--border-soft);
      font-size: 0.9rem;
    }

    .status-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-icon {
      font-size: 1rem;
      width: 1.5rem;
      text-align: center;
    }

    .status-label {
      font-weight: 500;
    }

    .status-sub {
      font-size: 0.78rem;
      color: var(--text-subtle);
    }

    .status-complete {
      color: var(--accent-soft);
    }

    .status-missed {
      color: var(--danger);
    }

    /* Graph */
    .graph {
      display: flex;
      align-items: flex-end;
      gap: 6px;
      height: 70px;
      margin: 8px 0 4px;
    }

    .graph-bar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .graph-bar {
      width: 14px;
      border-radius: 999px 999px 0 0;
      background: #111827;
      position: relative;
      overflow: hidden;
    }

    .graph-bar-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--accent-soft);
    }

    .graph-label {
      font-size: 0.7rem;
      margin-top: 2px;
      color: var(--text-subtle);
    }

    /* Settings */
    .settings-group {
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid #111827;
    }

    .settings-group:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .settings-label {
      font-size: 0.82rem;
      color: var(--text-subtle);
      margin-bottom: 3px;
    }

    select,
    input[type="date"],
    textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text);
      font-size: 0.9rem;
      font-family: inherit;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .danger-text {
      color: var(--danger);
      font-size: 0.8rem;
      margin-top: 3px;
    }

    /* Modal for "WTF is this?" */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.92);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal.hidden {
      display: none;
    }

    .modal-content {
      background: #020617;
      border-radius: 18px;
      padding: 16px;
      max-width: 380px;
      width: 90%;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.9);
    }

    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.25rem;
    }

    .modal-content img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 8px;
      display: block;
    }

    .modal-content p {
      font-size: 0.88rem;
      color: var(--text-subtle);
      margin-bottom: 12px;
    }

    .modal-close {
      width: 100%;
      padding: 8px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      background: var(--accent-soft);
      color: #022c22;
      cursor: pointer;
      font-weight: 600;
    }

    @media (max-width: 480px) {
      .app {
        padding: 12px;
      }
      .card {
        padding: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Workout Coach</h1>
      <div class="subtitle">
        Lightweight offline-ish workout tracker. Data stays in your browser.
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="today">Today</button>
        <button class="tab-btn" data-tab="history">History</button>
        <button class="tab-btn" data-tab="settings">Settings</button>
      </div>

      <!-- TODAY TAB -->
      <div id="tab-today" class="tab active">
        <div id="todayMeta" class="small-text"></div>

        <div id="focusRow" class="row-inline">
          <span class="small-text">Focus today:</span>
          <select id="focusSelect" class="inline-select"></select>
        </div>

        <div id="exerciseCountRow" class="row-inline" style="display:none;">
          <span class="small-text">Exercises to do:</span>
          <select id="exerciseCountSelect" class="inline-select"></select>
        </div>

        <h2 id="todayName"></h2>
        <ul id="exerciseList"></ul>
        <button class="primary" id="doneButton"></button>
        <div class="streak" id="streakText"></div>
      </div>

      <!-- HISTORY TAB -->
      <div id="tab-history" class="tab">
        <h2>Last 7 Days</h2>
        <div class="graph" id="historyGraph"></div>
        <div class="small-text">
          Green = completed, dark = missed. Bars are last 7 days (oldest on left).
        </div>

        <h3>Daily Status</h3>
        <div id="historyList"></div>
      </div>

      <!-- SETTINGS TAB -->
      <div id="tab-settings" class="tab">
        <div class="settings-group">
          <div class="settings-label">Plan</div>
          <select id="planSelect">
            <option value="ppl">Push / Pull / Legs (3-day split)</option>
            <option value="full">Full Body A / B (2-day split)</option>
          </select>
          <div class="small-text">
            If focus = "Plan default", this decides whether today is Push / Pull / Legs,
            or Full Body A / B.
          </div>
        </div>

        <div class="settings-group">
          <div class="settings-label">Start date</div>
          <input type="date" id="startDateInput" />
          <div class="small-text">
            Used to decide which workout comes on which day.
          </div>
        </div>

        <div class="settings-group">
          <div class="settings-label">Rest days</div>
          <select id="restSelect">
            <option value="0">No automatic rest days</option>
            <option value="4">Rest every 4th day</option>
          </select>
          <div class="small-text">
            With ‚Äúevery 4th day‚Äù, you‚Äôll get 3 workout days then a Rest Day.
          </div>
        </div>

        <div class="settings-group">
          <div class="settings-label">Backup / Restore</div>
          <button class="small" id="backupButton">Copy backup JSON to clipboard</button>
          <div class="small-text">
            Paste this JSON into a note or email to keep a backup of your progress.
          </div>
          <textarea
            id="restoreInput"
            placeholder="Paste backup JSON here to restore..."
          ></textarea>
          <button class="secondary" id="restoreButton">Restore from JSON</button>
          <div class="danger-text">
            Restoring will overwrite current progress with the backup.
          </div>
        </div>

        <div class="settings-group">
          <button class="secondary" id="resetButton">
            Reset progress (keep plan & start date)
          </button>
          <div class="danger-text">
            This clears completion history but keeps your plan and start date.
          </div>
        </div>

        <div class="small-text">
          Tip: Use an iOS Reminder like ‚ÄúDo workout ‚Äì open Workout Coach‚Äù for a daily ping.
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for WTF button -->
  <div id="exerciseModal" class="modal hidden">
    <div class="modal-content">
      <h2 id="modalTitle"></h2>
      <img id="modalImage" alt="" />
      <p id="modalText"></p>
      <button id="modalClose" class="modal-close">Got it</button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "wc_v2_data";

    // Plans (used when focus = "plan")
    const PLAN_LIBRARY = {
      ppl: {
        id: "ppl",
        name: "Push / Pull / Legs",
        days: [
          {
            name: "Push",
            exercises: [
              {
                name: "Bench Press",
                sets: 3,
                reps: 10,
                tip: "Lie on a bench, grip slightly wider than shoulders, lower to mid chest, and press while keeping your feet planted."
              },
              {
                name: "Shoulder Press",
                sets: 3,
                reps: 10,
                tip: "Sit or stand tall, press dumbbells or bar overhead, avoid arching your lower back."
              },
              {
                name: "Triceps Pushdown",
                sets: 3,
                reps: 12,
                tip: "Keep elbows pinned to your sides, push the cable handle down until arms are straight, then control it back up."
              }
            ]
          },
          {
            name: "Pull",
            exercises: [
              {
                name: "Lat Pulldown",
                sets: 3,
                reps: 10,
                tip: "Lean back slightly, pull the bar to upper chest, think about driving elbows down and back."
              },
              {
                name: "Row",
                sets: 3,
                reps: 10,
                tip: "Keep chest up and back flat, pull handle toward your mid-section, squeeze shoulder blades together."
              },
              {
                name: "Biceps Curl",
                sets: 3,
                reps: 12,
                tip: "Stand tall, elbows close to your sides, curl the weight up without swinging your body."
              }
            ]
          },
          {
            name: "Legs",
            exercises: [
              {
                name: "Squats",
                sets: 3,
                reps: 10,
                tip: "Feet shoulder-width apart, sit back like you‚Äôre sitting in a chair, keep chest up and knees tracking over toes."
              },
              {
                name: "Lunges",
                sets: 3,
                reps: 10,
                tip: "Step forward, drop the back knee toward the floor, push through the front heel to stand."
              },
              {
                name: "Calf Raises",
                sets: 3,
                reps: 15,
                tip: "Stand tall, raise your heels as high as possible, pause, then lower under control."
              }
            ]
          }
        ]
      },
      full: {
        id: "full",
        name: "Full Body A / B",
        days: [
          {
            name: "Full Body A",
            exercises: [
              {
                name: "Squat",
                sets: 3,
                reps: 8,
                tip: "Bar on your upper back, feet shoulder-width, sit down and back while keeping chest up."
              },
              {
                name: "Bench Press",
                sets: 3,
                reps: 8,
                tip: "Grip slightly wider than shoulders, lower under control, push the bar up and slightly back."
              },
              {
                name: "Barbell Row",
                sets: 3,
                reps: 8,
                tip: "Hinge at the hips, back flat, pull the bar toward your belly button, squeeze your back."
              }
            ]
          },
          {
            name: "Full Body B",
            exercises: [
              {
                name: "Deadlift",
                sets: 3,
                reps: 5,
                tip: "Bar over mid-foot, hinge at hips and knees, keep back flat, push the floor away and stand tall."
              },
              {
                name: "Overhead Press",
                sets: 3,
                reps: 8,
                tip: "Press bar or dumbbells overhead while squeezing your glutes and keeping ribs down."
              },
              {
                name: "Lat Pulldown",
                sets: 3,
                reps: 10,
                tip: "Pull bar to upper chest, don‚Äôt swing or yank with momentum."
              }
            ]
          }
        ]
      }
    };

    // Focus groups with up to 10 unique exercises each
    const GROUP_LIBRARY = {
      plan: {
        id: "plan",
        label: "Plan default",
        exercises: [] // uses PLAN_LIBRARY instead
      },
      legs: {
        id: "legs",
        label: "Legs",
        exercises: [
          { name: "Back Squat", sets: 3, reps: 8, tip: "Bar on your upper back, sit down and back, keep chest up." },
          { name: "Front Squat", sets: 3, reps: 8, tip: "Bar in front rack position, keep elbows high and torso upright." },
          { name: "Leg Press", sets: 3, reps: 12, tip: "Feet shoulder-width on platform, lower until knees are about 90¬∞, then press." },
          { name: "Romanian Deadlift", sets: 3, reps: 10, tip: "Slight knee bend, push hips back, feel stretch in hamstrings, keep back flat." },
          { name: "Walking Lunge", sets: 2, reps: 16, tip: "Step forward and drop back knee, push through front heel and continue walking." },
          { name: "Leg Curl", sets: 3, reps: 12, tip: "Control the weight both up and down, don‚Äôt arch your lower back." },
          { name: "Leg Extension", sets: 3, reps: 12, tip: "Kick the pad up until legs are almost straight, squeeze quads at the top." },
          { name: "Bulgarian Split Squat", sets: 3, reps: 10, tip: "Back foot on bench, drop straight down, push through front heel." },
          { name: "Calf Raise (Standing)", sets: 3, reps: 15, tip: "Raise heels as high as possible, pause, then lower slowly." },
          { name: "Calf Raise (Seated)", sets: 3, reps: 15, tip: "Focus on squeezing calves at the top of each rep." }
        ]
      },
      back: {
        id: "back",
        label: "Back",
        exercises: [
          { name: "Pull-ups / Assisted Pull-ups", sets: 3, reps: 8, tip: "Grip just wider than shoulders, pull chest to bar, control on the way down." },
          { name: "Lat Pulldown (Wide Grip)", sets: 3, reps: 10, tip: "Pull bar to top of chest, keep chest up and elbows down." },
          { name: "Seated Cable Row", sets: 3, reps: 10, tip: "Sit tall, pull handle to mid-stomach, squeeze shoulder blades together." },
          { name: "Single-arm Dumbbell Row", sets: 3, reps: 10, tip: "Support one hand on bench, pull dumbbell toward hip, keep back flat." },
          { name: "Chest-Supported Row", sets: 3, reps: 10, tip: "Lying on an incline bench, row dumbbells toward your ribs." },
          { name: "Straight-arm Pulldown", sets: 3, reps: 12, tip: "Keep arms nearly straight, pull bar from above head to thighs using lats." },
          { name: "Machine Row", sets: 3, reps: 10, tip: "Chest against pad, row handles toward your mid-section." },
          { name: "Face Pull", sets: 3, reps: 12, tip: "Pull rope to your forehead, elbows high, squeeze rear delts." },
          { name: "Inverted Row", sets: 3, reps: 8, tip: "Body straight under bar, pull chest toward bar." },
          { name: "Band Pull-Apart", sets: 3, reps: 15, tip: "Arms straight, pull band apart by squeezing shoulder blades together." }
        ]
      },
      chest: {
        id: "chest",
        label: "Chest",
        exercises: [
          { name: "Flat Bench Press", sets: 3, reps: 8, tip: "Grip slightly wider than shoulders, lower to mid chest, press up." },
          { name: "Incline Bench Press", sets: 3, reps: 8, tip: "Bench at 30‚Äì45¬∞, lower bar/dumbbells to upper chest." },
          { name: "Dumbbell Bench Press", sets: 3, reps: 10, tip: "Keep wrists stacked over elbows, control the weight." },
          { name: "Dumbbell Fly", sets: 3, reps: 12, tip: "Slight elbow bend, open arms wide, feel stretch in chest." },
          { name: "Cable Fly (High to Low)", sets: 3, reps: 12, tip: "Start high, pull handles down and together in front of hips." },
          { name: "Cable Fly (Low to High)", sets: 3, reps: 12, tip: "Start low, pull handles up and together in front of chest." },
          { name: "Push-ups", sets: 3, reps: 12, tip: "Body in a straight line, chest to floor, push away." },
          { name: "Machine Chest Press", sets: 3, reps: 10, tip: "Adjust seat so handles line up with mid-chest, press without locking elbows hard." },
          { name: "Single-arm Cable Press", sets: 3, reps: 10, tip: "Step forward into a split stance, press cable forward, keep core tight." },
          { name: "Deficit Push-ups", sets: 3, reps: 8, tip: "Hands on blocks or dumbbells, chest goes slightly lower than hands." }
        ]
      },
      shoulders: {
        id: "shoulders",
        label: "Shoulders",
        exercises: [
          { name: "Overhead Press", sets: 3, reps: 8, tip: "Press bar/dumbbells overhead, keep ribs down and glutes tight." },
          { name: "Seated Dumbbell Press", sets: 3, reps: 8, tip: "Sit tall, avoid flaring elbows straight out." },
          { name: "Lateral Raise", sets: 3, reps: 12, tip: "Raise dumbbells to the side slightly in front of body, thumbs just below pinkies." },
          { name: "Front Raise", sets: 3, reps: 12, tip: "Lift dumbbells in front to shoulder height, don‚Äôt swing." },
          { name: "Rear Delt Fly", sets: 3, reps: 12, tip: "Hinge forward, raise dumbbells out to the side, squeeze rear delts." },
          { name: "Face Pull", sets: 3, reps: 12, tip: "Pull rope to face, elbows high, rotate thumbs back." },
          { name: "Arnold Press", sets: 3, reps: 10, tip: "Start with palms facing you, rotate palms out as you press overhead." },
          { name: "Machine Shoulder Press", sets: 3, reps: 10, tip: "Seat height so handles are about chin level at bottom." },
          { name: "Cable Lateral Raise", sets: 3, reps: 12, tip: "Use cable at your side, raise until upper arm is parallel to floor." },
          { name: "Upright Row (light)", sets: 3, reps: 10, tip: "Pull bar/rope to upper chest, elbows higher than wrists." }
        ]
      },
      biceps: {
        id: "biceps",
        label: "Biceps",
        exercises: [
          { name: "Barbell Curl", sets: 3, reps: 10, tip: "Keep elbows close to sides, curl without swinging torso." },
          { name: "EZ-Bar Curl", sets: 3, reps: 10, tip: "Use a comfortable grip angle to spare wrists." },
          { name: "Dumbbell Curl", sets: 3, reps: 10, tip: "Rotate palms up as you curl (supinate) for more biceps." },
          { name: "Hammer Curl", sets: 3, reps: 10, tip: "Thumbs up grip, helps forearms and long head of biceps." },
          { name: "Incline Dumbbell Curl", sets: 3, reps: 10, tip: "Lie back on an incline bench, let arms hang behind you slightly." },
          { name: "Preacher Curl", sets: 3, reps: 10, tip: "Keep upper arm glued to pad, don‚Äôt bounce at the bottom." },
          { name: "Cable Curl", sets: 3, reps: 12, tip: "Use constant tension, squeeze at the top." },
          { name: "Reverse Curl", sets: 3, reps: 10, tip: "Overhand grip, target brachialis and forearms." },
          { name: "Concentration Curl", sets: 3, reps: 10, tip: "Elbow pressed into inner thigh, curl slowly with full control." },
          { name: "Spider Curl", sets: 3, reps: 10, tip: "Chest on an incline bench, let arms hang straight down and curl." }
        ]
      },
      triceps: {
        id: "triceps",
        label: "Triceps",
        exercises: [
          { name: "Close-grip Bench Press", sets: 3, reps: 8, tip: "Grip slightly inside shoulder width, keep elbows close to body." },
          { name: "Dip (Assisted if needed)", sets: 3, reps: 8, tip: "Lean slightly forward, lower until elbows ~90¬∞, press back up." },
          { name: "Triceps Pushdown (Rope)", sets: 3, reps: 12, tip: "Flare rope apart at the bottom for extra squeeze." },
          { name: "Overhead Triceps Extension", sets: 3, reps: 12, tip: "Elbows pointed up, lower dumbbell behind head, then extend." },
          { name: "Skull Crusher", sets: 3, reps: 10, tip: "Lower bar/dumbbells toward forehead or behind head, keep elbows in." },
          { name: "Bench Dip (feet on floor)", sets: 3, reps: 10, tip: "Hands on bench behind you, lower body down with elbows bending back." },
          { name: "Cable Kickback", sets: 3, reps: 12, tip: "Hinge forward, keep upper arm fixed, extend elbow fully." },
          { name: "Single-arm Cable Pushdown", sets: 3, reps: 12, tip: "Use one handle, keep elbow locked at your side." },
          { name: "Diamond Push-ups", sets: 3, reps: 8, tip: "Hands close under chest, keep elbows near ribs." },
          { name: "Triceps Press Machine", sets: 3, reps: 10, tip: "Adjust seat so elbows line up with machine pivot." }
        ]
      },
      core: {
        id: "core",
        label: "Core",
        exercises: [
          { name: "Plank", sets: 3, reps: 30, tip: "Elbows under shoulders, body in a straight line, squeeze glutes." },
          { name: "Side Plank", sets: 3, reps: 20, tip: "Stack feet, lift hips, keep body in a straight line." },
          { name: "Hanging Knee Raise", sets: 3, reps: 12, tip: "Don‚Äôt swing; lift knees by curling pelvis up." },
          { name: "Cable Woodchop", sets: 3, reps: 12, tip: "Rotate torso, don‚Äôt just move your arms." },
          { name: "Ab Wheel Rollout", sets: 3, reps: 8, tip: "Keep core braced, roll only as far as you can without sagging." },
          { name: "Dead Bug", sets: 3, reps: 10, tip: "Lower opposite arm/leg while keeping low back pressed to floor." },
          { name: "Russian Twist", sets: 3, reps: 20, tip: "Rotate from your torso, not just your arms." },
          { name: "Reverse Crunch", sets: 3, reps: 12, tip: "Curl hips off bench/floor, don‚Äôt just swing legs." },
          { name: "Cable Crunch", sets: 3, reps: 12, tip: "Think about curling ribs toward hips, not just pulling with arms." },
          { name: "Stability-Ball Crunch", sets: 3, reps: 15, tip: "Lower back draped over ball, curl up through your abs." }
        ]
      },
      cardio: {
        id: "cardio",
        label: "Cardio",
        exercises: [
          { name: "Treadmill Walk (Incline)", sets: 1, reps: 15, tip: "Brisk walk at slight incline, focus on steady breathing." },
          { name: "Treadmill Jog", sets: 1, reps: 10, tip: "Comfortable pace where you can still talk in short sentences." },
          { name: "Bike (Moderate)", sets: 1, reps: 15, tip: "Keep RPM steady, adjust resistance so legs work but don‚Äôt burn out instantly." },
          { name: "Rowing Machine", sets: 1, reps: 10, tip: "Legs drive first, then lean back slightly, finish with arms." },
          { name: "Stair Climber", sets: 1, reps: 10, tip: "Stand tall, don‚Äôt lean heavily on the rails." },
          { name: "Battle Ropes", sets: 1, reps: 1, tip: "Short, powerful waves; keep core tight and knees slightly bent." },
          { name: "Elliptical", sets: 1, reps: 15, tip: "Smooth, gliding motion, moderate resistance." },
          { name: "Incline Walk Intervals", sets: 1, reps: 10, tip: "Alternate 1 min moderate, 1 min easier pace." },
          { name: "Bike Sprints", sets: 1, reps: 8, tip: "Short 15‚Äì20s hard pushes, then easy pedaling to recover." },
          { name: "Jump Rope", sets: 1, reps: 5, tip: "Small jumps, land softly, keep wrists doing most of the work." }
        ]
      }
    };

    const FOCUS_ORDER = [
      "plan",
      "legs",
      "back",
      "chest",
      "shoulders",
      "biceps",
      "triceps",
      "core",
      "cardio"
    ];

    function todayLocal() {
      return new Date();
    }

    function dateOnly(d) {
      return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function formatDateKey(d) {
      return d.toISOString().slice(0, 10);
    }

    function parseDateKey(key) {
      const [y, m, d] = key.split("-").map((x) => parseInt(x, 10));
      return new Date(y, m - 1, d);
    }

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) throw new Error("no data");
        const parsed = JSON.parse(raw);
        if (!parsed.planId || !PLAN_LIBRARY[parsed.planId]) {
          parsed.planId = "ppl";
        }
        if (!parsed.startDateIso) {
          parsed.startDateIso = formatDateKey(todayLocal());
        }
        if (!parsed.completed) parsed.completed = {};
        if (!parsed.restEvery) parsed.restEvery = 0;
        if (!parsed.perDayTargets) parsed.perDayTargets = {};
        if (!parsed.selectedFocus) parsed.selectedFocus = {};
        return parsed;
      } catch {
        const todayIso = formatDateKey(todayLocal());
        const fresh = {
          planId: "ppl",
          startDateIso: todayIso,
          completed: {},
          restEvery: 0,
          perDayTargets: {},
          selectedFocus: {}
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(fresh));
        return fresh;
      }
    }

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    let state = loadData();

    function getPlan() {
      return PLAN_LIBRARY[state.planId] || PLAN_LIBRARY["ppl"];
    }

    function getDayInfo(date) {
      const plan = getPlan();
      const start = parseDateKey(
        state.startDateIso || formatDateKey(todayLocal())
      );
      const startOnly = dateOnly(start);
      const dOnly = dateOnly(date);
      const diffMs = dOnly - startOnly;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      if (diffDays < 0) {
        return { type: "prestart" };
      }

      if (state.restEvery && state.restEvery > 0) {
        const cycleIndex = diffDays % state.restEvery;
        if (cycleIndex === state.restEvery - 1) {
          return { type: "rest" };
        }
      }

      const nonRestCycleLength = plan.days.length;
      let trainingDayIndex = diffDays;

      if (state.restEvery && state.restEvery > 0) {
        const restsSoFar = Math.floor((diffDays + 1) / state.restEvery);
        trainingDayIndex = diffDays - restsSoFar;
      }

      const idx =
        ((trainingDayIndex % nonRestCycleLength) + nonRestCycleLength) %
        nonRestCycleLength;

      return { type: "workout", workout: plan.days[idx] };
    }

    // --- UI elements ---
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabs = {
      today: document.getElementById("tab-today"),
      history: document.getElementById("tab-history"),
      settings: document.getElementById("tab-settings")
    };

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tabId = btn.dataset.tab;
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        Object.entries(tabs).forEach(([id, el]) => {
          el.classList.toggle("active", id === tabId);
        });
      });
    });

    const todayMetaEl = document.getElementById("todayMeta");
    const todayNameEl = document.getElementById("todayName");
    const exerciseListEl = document.getElementById("exerciseList");
    const doneButtonEl = document.getElementById("doneButton");
    const streakTextEl = document.getElementById("streakText");
    const historyGraphEl = document.getElementById("historyGraph");
    const historyListEl = document.getElementById("historyList");
    const planSelectEl = document.getElementById("planSelect");
    const startDateInputEl = document.getElementById("startDateInput");
    const restSelectEl = document.getElementById("restSelect");
    const backupButtonEl = document.getElementById("backupButton");
    const restoreInputEl = document.getElementById("restoreInput");
    const restoreButtonEl = document.getElementById("restoreButton");
    const resetButtonEl = document.getElementById("resetButton");

    const focusSelectEl = document.getElementById("focusSelect");
    const exerciseCountRowEl = document.getElementById("exerciseCountRow");
    const exerciseCountSelectEl = document.getElementById("exerciseCountSelect");

    const modalEl = document.getElementById("exerciseModal");
    const modalTitleEl = document.getElementById("modalTitle");
    const modalImageEl = document.getElementById("modalImage");
    const modalTextEl = document.getElementById("modalText");
    const modalCloseEl = document.getElementById("modalClose");
    // Map exercise names to custom images in the repo
    const EXERCISE_IMAGES = {
    "Flat Bench Press": "bench-press.png", // example image in repo root
    "Back Squat": "Back-Squat.png",
    "Bulgarian Split Squat": "Bulgarian-SplitSquat.png",
    "Calf Raise (Standing)": "Calf-Raise.png",
    "Front Squat": "Front-Squat.png",
    "Leg Curl": "Leg-Curl.png",
    "Leg Extension": "Leg-Extension.png",
    "Leg Press": "Leg-Press.png",
    "Romanian Deadlift": "Romanian-Deadlift.png",
    "Calf Raise (Seated)": "Seated-CalfRaise.png",
    "Walking Lunge": "Walking-Lunge.png",
    "Pull-ups / Assisted Pull-ups": "Pull-ups---Assisted-Pull-ups.png",
    "Lat Pulldown (Wide Grip)": "Lat-Pulldown(Wide-Grip).png",
    "Seated Cable Row": "Seated-Cable-Row.png",
    "Chest-Supported Row": "Chest-Supported-Row.png",
    "Straight-arm Pulldown": "Straight-Arm-Pulldown.png",
    "Machine Row": "Machine-Row.png",
    "Face Pull": "Face-Pull.png",
    "Inverted Row": "Inverted-Row.png",
    "Band Pull-Apart": "Band-Pull-Apart.png",
    "Incline Bench Press": "Incline-Bench-Press.png",
    "Dumbbell Bench Press": "Dumbbell-Bench-Press.png",
    "Single-arm Dumbbell Row": "Single-Arm-Dumbbell-Row.png",
    "Dumbbell Fly": "Dumbbell-Fly.png",
    "Cable Fly (High to Low)": "Cable-Fly-High_To-Low.png",
    "Cable Fly (Low to High)": "Cable-Fly-Low-To-High.png",
    "Push-ups": "Push-Ups.png",
    "Machine Chest Press": "Machine-Chest-Press.png",
    "Single-arm Cable Press": "Single-Arm-Cable-Press.png",
    "Deficit Push-ups": "Deficit-Push-Ups.png",
    "Overhead Press": "Overhead-Press.png",
    "Seated Dumbbell Press": "Seated-Dumbbell-Press.png",
    "Lateral Raise": "lateral-Raise.png",
    "Front Raise": "Front-Raise.png",
    "Rear Delt Fly": "Rear-Delt-Fly.png",
    "Face Pull": "Face-Pull.png",
    "Arnold Press": "Arnold-Press.png",
    "Machine Shoulder Press": "Machine-Shoulder-Press.png",
    "Cable Lateral Raise": "cable-lateral-raise.png",
    "Upright Row (light)": "Upright-Row.png",
    "Barbell Curl": "Barbell-Curl.png",
    "EZ-Bar Curl": "EZ-Bar-Curl.png",
    "Dumbbell Curl": "Dumbbell-Curl.png",
    "Hammer Curl": "Hammer-Curls.png",
    "Incline Dumbbell Curl": "Incline-Dumbbell-Curls.png",
    "Preacher Curl": "Preacher-Curls.png",
    "Cable Curl": "Cable-Curl.png",
    "Reverse Curl": "Reverse-Curls.png",
    "Concentration Curl": "Concetration-Curls.png",
    "Spider Curl": "Spider-Curls.png",
    "Close-grip Bench Press": "Close-Grip-Bench-Press.png",
    "Dip (Assisted if needed)": "Dips.png",
    "Triceps Pushdown (Rope)": "Triceps-Pushdown.png",
    "Overhead Triceps Extension": "Overhead-Triceps-Extension.png",
    "Skull Crusher": "Skull-Crushers.png",
    "Bench Dip (feet on floor)": "Bench-Dip.png",
    "Cable Kickback": "Cable-KickBacks.png",
    "Single-arm Cable Pushdown": "Single-Arm-Cable-Pushdowns.png",
    "Diamond Push-ups": "Diamond-Pushups.png",
    "Triceps Press Machine": "Triceps-PressDown.png",
    "Plank": "Plank.png",
    "Side Plank": "Side-Plank.png",
    "Hanging Knee Raise": "Hanging-Knee-Raises.png",
    "Cable Woodchop": "Cable-WoodChop.png",
    "Ab Wheel Rollout": "Ab-Wheel-Rollouts.png",
    "Dead Bug": "DeadBug-Weighted.png",
    "Russian Twist": "Russian-Twist.png",
    "Reverse Crunch": "Reverse-Crunch.png",
    "Cable Crunch": "Cable-Crunch.png",
    "Stability-Ball Crunch": "Stability-BallCrunch.png",
    "Treadmill Walk (Incline)": "Treadmill.png",
    "Treadmill Jog": "Treadmill-Run.png",
    "Bike (Moderate)": "Bike.png",
    "Rowing Machine": "Machine-Row.png",
    "Stair Climber": "Stair-Climber.png",
    "Battle Ropes": "Battle-Ropes.png",
    "Elliptical": "Elliptical.png",
    "Incline Walk Intervals": "Inclined-Walk.png",
    "Bike Sprints": "Bike-Sprints.png",
    "Jump Rope": "Jump-Rope.png"
    
};
    modalCloseEl.onclick = () => {
      modalEl.classList.add("hidden");
    };
    modalEl.addEventListener("click", (e) => {
      if (e.target === modalEl) {
        modalEl.classList.add("hidden");
      }
    });

   function showExerciseModal(ex) {
  modalTitleEl.textContent = ex.name;
  modalTextEl.textContent =
    ex.tip || "Form tip coming soon. Focus on slow, controlled reps.";

  // If we have a custom image for this exercise, use it.
  const customImage = EXERCISE_IMAGES[ex.name];

  if (customImage) {
    // File in the repo (e.g., bench-press.png)
    modalImageEl.src = customImage;
  } else {
    // Fallback placeholder if you haven't wired a real image yet
    const safeName = encodeURIComponent(ex.name.replace(/\s+/g, "+"));
    modalImageEl.src =
      "https://via.placeholder.com/320x200.png?text=" + safeName;
  }

  modalEl.classList.remove("hidden");
}
    // --- Focus helpers ---
    function getFocusForDate(dateKey) {
      state.selectedFocus = state.selectedFocus || {};
      return state.selectedFocus[dateKey] || "plan";
    }

    function setFocusForDate(dateKey, focusId) {
      state.selectedFocus = state.selectedFocus || {};
      if (focusId === "plan") {
        delete state.selectedFocus[dateKey];
      } else {
        state.selectedFocus[dateKey] = focusId;
      }
      saveData(state);
    }

    function buildFocusOptions(selectedId) {
      focusSelectEl.innerHTML = "";
      FOCUS_ORDER.forEach((id) => {
        const def = GROUP_LIBRARY[id];
        if (!def) return;
        const opt = document.createElement("option");
        opt.value = id;
        opt.textContent = def.label;
        if (id === selectedId) opt.selected = true;
        focusSelectEl.appendChild(opt);
      });
    }

    // --- Today tab ---
    function renderToday() {
      const today = todayLocal();
      const todayKey = formatDateKey(today);
      const info = getDayInfo(today);
      const plan = getPlan();

      todayMetaEl.textContent = `${today.toLocaleDateString(undefined, {
        weekday: "long",
        month: "short",
        day: "numeric"
      })} ‚Ä¢ ${plan.name}`;

      exerciseListEl.innerHTML = "";
      exerciseCountRowEl.style.display = "none";

      if (info.type === "prestart") {
        todayNameEl.textContent = "Plan hasn‚Äôt started yet";
        doneButtonEl.textContent = "Start plan today";
        doneButtonEl.classList.remove("done");
        doneButtonEl.onclick = () => {
          state.startDateIso = todayKey;
          state.completed = state.completed || {};
          saveData(state);
          alert("Plan started from today!");
          renderAll();
        };
        streakTextEl.textContent =
          "Once the plan starts, your streak will show here.";
        return;
      }

      if (info.type === "rest") {
        todayNameEl.textContent = "Rest Day üò¥";
        const li = document.createElement("li");
        li.className = "exercise-row";
        li.innerHTML =
          '<div class="exercise-main"><span class="exercise-name">Light walk, stretching, or full rest.</span><span class="badge">Optional</span></div>';
        exerciseListEl.appendChild(li);

        setupDoneButton(todayKey);
        updateStreak();
        return;
      }

      if (info.type === "workout") {
        const focusId = getFocusForDate(todayKey);
        buildFocusOptions(focusId);

        focusSelectEl.onchange = () => {
          setFocusForDate(todayKey, focusSelectEl.value);
          renderToday();
        };

        let baseExercises = [];
        if (focusId === "plan" || !GROUP_LIBRARY[focusId]) {
          todayNameEl.textContent = info.workout.name;
          baseExercises = info.workout.exercises.slice();
        } else {
          todayNameEl.textContent = GROUP_LIBRARY[focusId].label;
          baseExercises = GROUP_LIBRARY[focusId].exercises.slice();
        }

        if (!baseExercises || baseExercises.length === 0) {
          exerciseListEl.innerHTML = "";
        } else {
          const MAX_COUNT = 10;
          const maxSelectable = Math.min(MAX_COUNT, baseExercises.length);

          state.perDayTargets = state.perDayTargets || {};
          let target = state.perDayTargets[todayKey];
          if (!target || target < 1 || target > maxSelectable) {
            target = maxSelectable;
          }

          exerciseCountRowEl.style.display = "flex";
          exerciseCountSelectEl.innerHTML = "";
          for (let i = 1; i <= maxSelectable; i++) {
            const opt = document.createElement("option");
            opt.value = i;
            opt.textContent = i;
            if (i === target) opt.selected = true;
            exerciseCountSelectEl.appendChild(opt);
          }

          exerciseCountSelectEl.onchange = () => {
            const val =
              parseInt(exerciseCountSelectEl.value, 10) || maxSelectable;
            state.perDayTargets[todayKey] = Math.max(
              1,
              Math.min(maxSelectable, val)
            );
            saveData(state);
            renderToday();
          };

          const list = baseExercises.slice(0, target); // no repeats
          list.forEach((ex) => {
            const li = document.createElement("li");
            li.className = "exercise-row";

            const main = document.createElement("div");
            main.className = "exercise-main";

            const nameSpan = document.createElement("span");
            nameSpan.className = "exercise-name";
            nameSpan.textContent = ex.name;

            const badgeSpan = document.createElement("span");
            badgeSpan.className = "badge";
            badgeSpan.textContent = `${ex.sets} √ó ${ex.reps}`;

            main.appendChild(nameSpan);
            main.appendChild(badgeSpan);

            const infoBtn = document.createElement("button");
            infoBtn.type = "button";
            infoBtn.className = "info-btn";
            infoBtn.textContent = "WTF?";
            infoBtn.onclick = () => showExerciseModal(ex);

            li.appendChild(main);
            li.appendChild(infoBtn);
            exerciseListEl.appendChild(li);
          });
        }
      }

      setupDoneButton(todayKey);
      updateStreak();
    }

    function setupDoneButton(todayKey) {
      const isDone = !!state.completed[todayKey];
      if (isDone) {
        doneButtonEl.textContent = "Completed ‚úî";
        doneButtonEl.classList.add("done");
      } else {
        doneButtonEl.textContent = "Mark as done";
        doneButtonEl.classList.remove("done");
      }

      doneButtonEl.onclick = () => {
        const currentlyDone = !!state.completed[todayKey];
        if (currentlyDone) {
          delete state.completed[todayKey];
        } else {
          state.completed[todayKey] = true;
        }
        saveData(state);
        renderAll();
      };
    }

    function computeStreak() {
      let streak = 0;
      let day = dateOnly(todayLocal());
      while (true) {
        const key = formatDateKey(day);
        if (state.completed[key]) {
          streak++;
          day = new Date(day.getTime() - 24 * 60 * 60 * 1000);
        } else {
          break;
        }
      }
      return streak;
    }

    function updateStreak() {
      const streak = computeStreak();
      if (streak > 0) {
        streakTextEl.innerHTML = `Current streak: <span class="streak-strong">${streak} day${
          streak === 1 ? "" : "s"
        }</span>`;
      } else {
        streakTextEl.textContent =
          "No current streak yet. Today‚Äôs a good day to start!";
      }
    }

    // --- History ---
    function renderHistory() {
      const today = dateOnly(todayLocal());
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
        const key = formatDateKey(d);
        const info = getDayInfo(d);
        const isDone = !!state.completed[key];
        days.push({ date: d, key, info, isDone });
      }

      historyGraphEl.innerHTML = "";
      days.forEach((d) => {
        const wrap = document.createElement("div");
        wrap.className = "graph-bar-wrapper";

        const bar = document.createElement("div");
        bar.className = "graph-bar";
        const fill = document.createElement("div");
        fill.className = "graph-bar-fill";
        const height = d.isDone ? 100 : 12;
        fill.style.height = height + "%";
        bar.appendChild(fill);

        const label = document.createElement("div");
        label.className = "graph-label";
        label.textContent = d.date.toLocaleDateString(undefined, {
          weekday: "short"
        })[0];

        wrap.appendChild(bar);
        wrap.appendChild(label);
        historyGraphEl.appendChild(wrap);
      });

      historyListEl.innerHTML = "";
      days
        .slice()
        .reverse()
        .forEach((d) => {
          const row = document.createElement("div");
          row.className = "status-row";

          const left = document.createElement("div");
          left.className = "status-left";

          const icon = document.createElement("div");
          icon.className = "status-icon";
          if (d.info.type === "rest") icon.textContent = "üò¥";
          else if (d.isDone) icon.textContent = "‚úÖ";
          else icon.textContent = "‚¨ú";

          const labels = document.createElement("div");
          const labelMain = document.createElement("div");
          labelMain.className = "status-label";
          labelMain.textContent = d.date.toLocaleDateString(undefined, {
            weekday: "short",
            month: "short",
            day: "numeric"
          });

          const labelSub = document.createElement("div");
          labelSub.className = "status-sub";

          if (d.info.type === "rest") {
            labelSub.textContent = "Rest day";
          } else if (d.info.type === "prestart") {
            labelSub.textContent = "Before start";
          } else if (d.info.type === "workout") {
            labelSub.textContent = d.info.workout.name;
          } else {
            labelSub.textContent = "No workout";
          }

          labels.appendChild(labelMain);
          labels.appendChild(labelSub);

          left.appendChild(icon);
          left.appendChild(labels);

          const right = document.createElement("div");
          right.className =
            d.info.type === "rest"
              ? ""
              : d.isDone
              ? "status-complete"
              : "status-missed";
          right.textContent =
            d.info.type === "rest"
              ? ""
              : d.isDone
              ? "Done"
              : "Missed";

          row.appendChild(left);
          row.appendChild(right);
          historyListEl.appendChild(row);
        });
    }

    // --- Settings ---
    function renderSettings() {
      planSelectEl.value = state.planId || "ppl";
      startDateInputEl.value =
        state.startDateIso || formatDateKey(todayLocal());
      restSelectEl.value = String(state.restEvery || 0);
    }

    function renderAll() {
      state = loadData();
      renderToday();
      renderHistory();
      renderSettings();
    }

    planSelectEl.addEventListener("change", () => {
      const newPlan = planSelectEl.value;
      if (PLAN_LIBRARY[newPlan]) {
        state.planId = newPlan;
        saveData(state);
        renderAll();
      }
    });

    startDateInputEl.addEventListener("change", () => {
      const val = startDateInputEl.value;
      if (val) {
        state.startDateIso = val;
        saveData(state);
        renderAll();
      }
    });

    restSelectEl.addEventListener("change", () => {
      const val = parseInt(restSelectEl.value, 10) || 0;
      state.restEvery = val;
      saveData(state);
      renderAll();
    });

    backupButtonEl.addEventListener("click", async () => {
      const data = localStorage.getItem(STORAGE_KEY) || "{}";
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(data);
          alert("Backup JSON copied to clipboard.");
        } else {
          alert("Clipboard API not available. JSON placed in the box instead.");
          restoreInputEl.value = data;
        }
      } catch {
        restoreInputEl.value = data;
        alert("Could not copy automatically. Backup JSON placed in box.");
      }
    });

    restoreButtonEl.addEventListener("click", () => {
      const raw = restoreInputEl.value.trim();
      if (!raw) {
        alert("Paste backup JSON first.");
        return;
      }
      if (!confirm("Restore backup? This will overwrite current progress.")) {
        return;
      }
      try {
        const parsed = JSON.parse(raw);
        if (!parsed.startDateIso || !parsed.planId) {
          throw new Error("invalid");
        }
        localStorage.setItem(STORAGE_KEY, raw);
        state = loadData();
        renderAll();
        alert("Backup restored.");
      } catch {
        alert("Backup JSON is invalid.");
      }
    });

    resetButtonEl.addEventListener("click", () => {
      if (!confirm("Clear completion history but keep plan & start date?"))
        return;
      state.completed = {};
      saveData(state);
      renderAll();
    });

    // Initial render
    renderAll();
  </script>
</body>
</html>
















